<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue Cart</title>
    <!-- 개발버전, 도움되는 콘솔 경고를 포함. -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>
<body>
    <!-- 렌더링 영역 -->
    <div id="app">
        <cart-header></cart-header>
        <!-- true:display: block된 것처럼 화면에 보임-->
        <!-- false: display: none된 것처럼 화면에 안보임-->
        <div v-show="showAll"> 
            <h2>전체목록</h2>
            <ul>
                <li v-for="item in items">{{ item.name }}</li>
            </ul>
        </div>
        <shop-list v-bind:shopping-items="items"></shop-list>
        <cart-input v-on:add-item="addItem"></cart-input>
        <input type="checkbox" v-model="showOption">산 물건 보기
        <bought-list
         v-bind:bought-items="items"
         v-show="showOption"
         v-on:remove-item="removeItem">
        </bought-list>
        <cart-footer></cart-footer> 
    </div>
    <script>
        // 전역 컴포넌트
        // * 여러 인스턴스에서 공통으로 사용할 수 있음
        Vue.component("cart-header", {
            template: '<h1>{{ title }}</h1>',
            data: function() {
                return {
                    title: 'Vue Cart'
                }
            }
        })

        Vue.component("cart-footer", {
            template: "<p>&copy; Bit Academy</p>"
        })

        // 살 물건들 목록
        var shopList = {
          // props 받아오기
          props: ['shopping-items'],
          template: `
          <div>
            <h2>살 물건들</h2>
            <ul>
              <li v-for="(item, index) in shoppingItems"
                  v-if="!item.buy">{{item.name}}
                  <button @click="buyItem(item, index)">구매</button>
              </li>
            </ul>
          </div>`,
          methods: {
              buyItem:  function(item, index) {
                  console.log("구매할 아이템:", item);
                  item.buy = true;
              }
          }
        }

        // 산 물건 목록
        var boughtList = {
          // props 받아오기
          props: ["bought-items"],
          template: `
          <div>
            <h2>산 물건들</h2>
            <ul>
              <li v-for="(item, index) in boughtItems"
                  v-if="item.buy">{{item.name}}
                  <button v-on:click="removeItem(item)">삭제</button>
                  <button v-on:click="cancelBuy(item)"">구매취소</button>
              </li>
            </ul>
          </div>`,
          methods: {
            cancelBuy: function(item) {
              item.buy = false;
            },
            removeItem: function(item) {
                //부모로 삭제할 아이템을 전송
                console.log("삭제할 아이템:", item);
                this.$emit("remove-item", item);
            }
        }
      }
        // cart input 컴포넌트
        var cartInput =  {
          template: `
          <div>
              <input v-model="newItem"><button v-on:click="addItem">추가</button>
          </div>`,
          data: function() {
              return {
                newItem: "" // 69 73은 양방향 데이터 변경

              }
          },
          methods: {
              addItem: function() {
                  console.log("추가할 아이템:", this.newItem);  // 해당 줄에서는 생성된 newItem을 부모로 전송하여 이벤트를 발생시키는 방법을 생각해본다.
                  if(this.newItem.trim().length > 0) {
                    // 구매 아이템을 부모로 전송
                    this.$emit("add-item", this.newItem.trim());
                    this.newItem = "";
                  }
              }
          }
        }
        //  Vue 인스턴스
        var app = new Vue({
            el: "#app", // id 셀렉터
            data : {
              items: [
                  {name: "무", buy: false },
                  {name: "배추", buy: false },
                  {name: "쪽파", buy: true },
                  {name: "고춧가루", buy: true }
              ],
              showAll: false,
              showOption: true
            },
            // #지역 컴포넌트 사용시 명시적으로 선언해줘야 한다.
            components: {
                "shop-list": shopList,
                "cart-input": cartInput,
                "bought-list": boughtList
            },

            // #addItem 이벤트를 처리할 수 있는 메서드
            methods: {
                addItem: function(item) { // #버튼 클릭시 실행하는 함수
                    console.log("추가할 아이템:", item);
                    // 배열에 아이템 추가
                    this.items.push({   // #this 주의
                        name: item, 
                        buy: false
                    })
                },
                removeItem: function(item) {
                    var index = this.items.indexOf(item);
                    if (index > -1) { // 인덱스
                      // 배열에서 요소삭제
                      this.items.splice(index, 1);
                    }
                }
            }
        });
    </script>
</body>
</html>